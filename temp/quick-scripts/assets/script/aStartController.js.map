{"version":3,"sources":["aStartController.js"],"names":["iconConf","canGo","startPoint","endPoint","onCan","kCost1","kCost2","aStartArrays","startManager","view","_instance","xL","length","yL","opens","closes","init","point","target","isIgnoreCorner","x","y","curData","isInList","Math","abs","currentPoint","currentX","currentY","rows","isCanreach","push","data","tempStart","dis","extrG","parentG","G","tempEnd","sqrt","H","openList","resPoint","index","i","F","list","result","_findWay","path","unshift","parent","start","end","splice","curPoint","getLeastFPoint","curP","surroundPoints","getSurroundPoints","cacG","cacH","cacF","tempG","module","exports"],"mappings":"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","file":"aStartController.js","sourceRoot":"../../../../assets/script","sourcesContent":["\nconst iconConf = {\n    canGo:0,\n    startPoint:1,\n    endPoint:2,\n    onCan:3,\n}\n\nconst  kCost1 = 10; //直移一格消耗\nconst  kCost2 = 14; //斜移一格消耗\n\n/*-3 表示不可行\n0表示可通过\n\n*/\nlet aStartArrays= [\n    [0,0,0,0,0,0,0,0,0,0,0],\n    [0,0,0,0,0,0,0,0,0,0,0],\n    [0,0,0,0,0,-3,0,0,0,0,0],\n    [0,0,-1,0,0,-3,0,0,0,0,0],\n    [0,0,0,0,0,-3,0,0,0,0,0],\n    [0,0,0,0,0,-3,0,0,0,0,0],\n    [0,0,0,0,0,-3,0,0,-2,0,0],\n    [0,0,0,0,0,0,0,0,0,0,0],\n    [0,0,0,0,0,0,0,0,0,0,0],\n    [0,0,0,0,0,0,0,0,0,0,0]\n];\nclass startManager{\n    static getInstance(view){\n        if(!_instance) _instance = new startManager(view);\n        return _instance;\n    }\n    constructor(view) {\n        this.view = view;\n        this.aStartArrays = aStartArrays\n        this.xL = this.aStartArrays.length;\n        this.yL = this.aStartArrays[0].length;\n        this.opens = []; //开放列表\n        this.closes = []; //关闭列表\n    }\n    start(){\n        this.view && this.view.init(this.aStartArrays);\n    }\n\n    getxL(){\n        return this.xL;\n    }\n\n    getyL(){\n        return this.yL;\n    }\n\n    //是否可以加到斜角中去\n    isCanreach(point, target, isIgnoreCorner){\n        if(target.x < 0 || target.y < 0) return;\n        let curData = this.aStartArrays[target.x][target.y];\n        if(target.x < 0 || target.x > this.xL - 1 || target.y < 0 || target.y > this.yL - 1 || curData == -3 || this.isInList(this.closes, target)){//超出范围\n            return false;\n        }else{\n            if (Math.abs(point.x - target.x) + Math.abs(point.y - target.y) == 1){ //非斜角可以\n                return true;\n            }else{\n                return isIgnoreCorner; \n            }\n        }\n    }\n\n    //获取周边的点\n    getSurroundPoints(currentPoint, isIgnoreCorner){\n        let currentX = currentPoint.x;\n        let currentY = currentPoint.y;\n        let rows = [];\n        for(let x = currentX - 1; x <= currentX + 1; x++){\n            for(let y = currentY-1; y <= currentY + 1; y++){\n                \n                if(this.isCanreach(currentPoint,{x: x,y: y}, isIgnoreCorner)){\n                    rows.push({x: x, y: y, data: this.aStartArrays[x][y]})\n                }\n            }\n        }\n        return rows;\n    }\n\n    cacG(tempStart, point){\n        let dis =  Math.abs(point.x - tempStart.x) + Math.abs(point.y - tempStart.y);\n        if(dis == 0) return 0;\n        let extrG = (dis == 1?kCost1: kCost2);\n        let parentG = tempStart.G || 0;\n        return parentG + extrG;\n    }\n\n    cacH(tempEnd, point){\n        return Math.sqrt((point.x - tempEnd.x)*(point.x - tempEnd.x) + (point.y - tempEnd.y)* (point.y - tempEnd.y))*kCost1;\n    }\n\n    cacF(point){\n        return point.H + point.G;\n    }\n\n    getLeastFPoint(openList){\n        if(openList.length > 0){\n            let resPoint = openList[0];\n            let index = 0;\n            for(let i = 0; i < openList.length; i++){\n                if(openList[i].F < resPoint.F){\n                    resPoint = openList[i];\n                    index = i;\n                }\n            }\n            return {resPoint:resPoint,index:index};\n        }\n        return null;\n    }\n\n    isInList(list, target){\n        for (let i = 0; i < list.length; i++){\n            let curData = list[i];\n            if(curData.x == target.x && curData.y == target.y){\n                return curData;\n            }\n        }\n        return null;\n    }\n\n    GetPath(startPoint, endPoint, isIgnoreCorner)\n    {\n        let result = this._findWay(startPoint, endPoint, isIgnoreCorner);\n        let  path = [];\n        //返回路径，如果没找到路径，返回空链表\n        while (result)\n        {\n            path.unshift(result);\n            result = result.parent;\n        }\n        return path;\n    }\n\n    _findWay(start, end, isIgnoreCorner){\n        this.opens.splice(0, this.opens.length);\n        this.closes.splice(0, this.closes.length);\n        this.opens.push(start);\n        while(this.opens.length>0){\n            let curPoint = this.getLeastFPoint(this.opens);//找到F值最小的点\n            if(!curPoint) break;\n            let curP = curPoint.resPoint;\n            this.opens.splice(curPoint.index,1);\n            curPoint && this.closes.push(curPoint.resPoint);//放到关闭列表\n            //1,找到当前周围格中可以通过的格子\n            let surroundPoints = this.getSurroundPoints(curPoint.resPoint, isIgnoreCorner);\n            for(let i = 0; i < surroundPoints.length; i++){\n                let target = surroundPoints[i];\n                //2,对某一个格子，如果它不在开启列表中，加入到开启列表，设置当前格为其父节点，计算F G H\n                if(!this.isInList(this.opens, target)){\n                    target.parent  = curP;\n                    target.G = this.cacG(curP, target);\n                    target.H = this.cacH(end, target);\n                    target.F = this.cacF(target);\n                    this.opens.push(target);\n                }else{//3，对某一个格子，它在开启列表中，计算G值, 如果比原来的大, 就什么都不做, 否则设置它的父节点为当前点,并更新G和F\n                    let tempG = this.cacG(curP, target);\n                    if(tempG < target.G){\n                        target.parent = curP;\n                        target.G = this.cacG(curP, target);\n                        target.F = this.cacF(target);\n                    }\n                }\n                let resPoint = this.isInList(this.closes, end);\n                if(resPoint){\n                    return resPoint;\n                }\n            }\n        }\n        return null;\n    }\n};\nlet _instance = null;\nmodule.exports = startManager;\n"]}